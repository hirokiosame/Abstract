{"version":3,"sources":["../src/sqlBuilder.js"],"names":[],"mappings":"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","file":"sqlBuilder.js","sourcesContent":["export default {\n\n\tcreateTable (model) {\n\n\t\tlet attributes = [];\n\n\n\t\t// Attributes\n\t\tfor( let attribute in model.attributes ){\n\t\t\tlet opts = model.attributes[attribute];\n\n\t\t\tif( opts instanceof Function ){\n\n\t\t\t\tattributes.push(`\\`${attribute}\\` ${opts.attributes[opts.primaryKey].type || \"\"}`);\t\n\n\t\t\t\tattributes.push(`FOREIGN KEY (\\`${attribute}\\`) REFERENCES ${opts.tableName} (\\`${opts.primaryKey}\\`) ON DELETE CASCADE ON UPDATE CASCADE`);\t\n\t\t\t}\n\n\t\t\telse if( opts instanceof Object ){\n\t\t\t\tattributes.push(`\\`${attribute}\\` ${opts.type || \"\"} ${opts.misc || \"\"}`);\t\n\t\t\t}\n\n\t\t}\n\n\t\t// Primary Key\n\t\tif( typeof model.primaryKey === \"string\" && model.attributes[model.primaryKey] ){\n\t\t\tattributes.push(\"PRIMARY KEY (`\" + model.primaryKey + \"`)\");\n\t\t}\n\n\t\t// Unique keys\n\t\tif( model.uniqueKeys instanceof Array ){\n\t\t\tattributes.push(\"UNIQUE KEY (`\" + model.uniqueKeys.join(\"`, `\") + \"`)\");\n\t\t}\n\n\n\t\tlet query = `CREATE TABLE IF NOT EXISTS \\`${model.tableName}\\` (\n\t\t\t${attributes.join(\",\\n\")}\n\t\t) ENGINE=InnoDB DEFAULT CHARSET=latin1;`;\n\n\t\treturn query;\n\t},\n\n\tinsertModel (model) {\n\n\t\tconst attributes = model.attributes;\n\n\t\tlet insertAttributes = [],\n\t\t\tvalues = [];\n\n\t\tfor (let att in attributes) {\n\n\t\t\tif (!(this.hasOwnProperty(att))) { continue; }\n\n\t\t\tif (attributes[att] instanceof Function) {\n\n\t\t\t\tif (this[att] instanceof attributes[att]) {\n\t\t\t\t\t// Insert PK\n\t\t\t\t\tinsertAttributes.push(att);\n\t\t\t\t\tvalues.push(this[att][attributes[att].primaryKey]);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tinsertAttributes.push(att);\n\t\t\tvalues.push(this[att]);\n\t\t}\n\n\t\treturn [\n\t\t\t`INSERT INTO \\`${model.tableName}\\`\n\t\t\t(${insertAttributes}) VALUES (${Array(values.length).fill('?')})\n\t\t\t-- ON DUPLICATE KEY UPDATE ${insertAttributes.map((k) => `${k}=values(${k})`)};\n\t\t\t`,\n\t\t\tvalues\n\t\t];\n\t},\n\n\tupdateModel (model) {\n\n\t\tlet set = [],\n\t\t\tvalues = [];\n\n\t\tfor (let att in model.attributes) {\n\t\t\t// if( att === model.primaryKey ){ continue; }\n\n\t\t\tlet value = this[att];\n\n\t\t\tset.push(`\\`${att}\\` = ?`);\n\n\t\t\tif (value instanceof Object) {\n\t\t\t\tlet _model = value.constructor;\n\t\t\t\tvalues.push(value[_model.primaryKey]);\n\t\t\t}else{\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t}\n\t\tvalues.push(this[model.primaryKey]);\n\n\n\t\tif (set.length === 0) {\n\t\t\treturn [null, null];\n\t\t}\n\n\n\t\tlet query = `UPDATE ${model.tableName} SET ${set} WHERE ${model.primaryKey} = ?;`;\n\n\t\treturn [query, values];\n\t}\n};"]}